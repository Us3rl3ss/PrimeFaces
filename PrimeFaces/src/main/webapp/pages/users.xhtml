<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<h:head>
</h:head>

<h:body>

	<ui:composition template="templates/common.xhtml">
	
		<ui:define name="content">

			<h:form id="friends">
			
				<p:panelGrid columns="2">
				
					<p:outputLabel value="Korisnici:"></p:outputLabel>
					<p:autoComplete id="searchUser" minQueryLength="3" maxResults="5"
						placeholder="Pretraži" value="#{usersMB.user}"
						completeMethod="#{usersMB.completeUser}" effect="fade"
						var="user" itemLabel="#{user.username}" itemValue="#{user}"
						converter="#{userConverter}" forceSelection="true">

						<p:ajax event="itemSelect" listener="#{usersMB.onItemSelect}"
							update="userInormations"></p:ajax>
					</p:autoComplete>

				</p:panelGrid>

				<p:panelGrid columns="1" id="userInormations">

					<p:panel id="userInfo" header="#{usersMB.user.username}"
						style="margin-bottom:20px">
						<h:panelGrid columns="2" cellpadding="10">

							<h:outputText value="Ime:" />
							<h:outputText value="#{usersMB.user.firstname}" />

							<h:outputText value="Prezime:" />
							<h:outputText value="#{usersMB.user.lastname}" />

							<h:outputText value="Godina rođenja:" />
							<h:outputText value="#{usersMB.user.date_of_birth}">
								<f:convertDateTime pattern="dd.MM.yyyy" />
							</h:outputText>

							<h:outputText value="Email:" />
							<h:outputText value="#{usersMB.user.email}" />

						</h:panelGrid>

						<f:facet name="actions">
							<h:commandLink disabled="#{usersMB.inFollowList}"
								styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default">
								<h:outputText styleClass="ui-icon ui-icon-check" />
								<f:ajax listener="#{usersMB.addToFollowList}" />
							</h:commandLink>
						</f:facet>
					</p:panel>

					<p:dataList value="#{usersMB.userMovieRateList}" var="rate"
						type="unordered" itemType="none" paginator="true" rows="5"
						styleClass="paginated">
						<f:facet name="header">
				            Ocjene
				        </f:facet>
						<p:commandLink update=":friends:rateDetail"
							action="#{usersMB.calculateAverageRate}"
							oncomplete="PF('rateDialog').show()" title="Detalji"
							styleClass="ui-icon ui-icon-search"
							style="float:left;margin-right:10px">
							<f:setPropertyActionListener value="#{rate}"
								target="#{usersMB.selectedRate}" />
						</p:commandLink>
						<p:rating value="#{rate.rate}" stars="10" cancel="false"
							style="display:inline-block" readonly="#{true}">
						</p:rating>
						<h:outputText value="#{rate.created}">
							<f:convertDateTime pattern="HH:MM dd.MM.yyyy" />
						</h:outputText>
						<h:outputText value="&#160;-&#160;#{rate.movie.name}"
							style="display:inline-block" />
					</p:dataList>

					<p:dataList value="#{usersMB.userFavoriteMovieList}"
						var="favorite" type="unordered" itemType="none" paginator="true"
						rows="5" styleClass="paginated">
						<f:facet name="header">
			            Favoriti
			        </f:facet>
						<p:commandLink update=":friends:favoriteDetail"
							oncomplete="PF('favoriteDialog').show()" title="Detalji"
							styleClass="ui-icon ui-icon-search"
							style="float:left;margin-right:10px">
							<f:setPropertyActionListener value="#{favorite}"
								target="#{usersMB.selectedFavorite}" />
						</p:commandLink>
						<h:outputText value="#{favorite.created}">
							<f:convertDateTime pattern="HH:MM dd.MM.yyyy" />
						</h:outputText>
						<h:outputText value="&#160;-&#160;#{favorite.movie.name}"
							style="display:inline-block" />
					</p:dataList>

					<p:dataList value="#{usersMB.userMovieReviewList}" var="review"
						type="unordered" itemType="none" paginator="true" rows="5"
						styleClass="paginated">
						<f:facet name="header">
			            Recenzije
			        </f:facet>
						<p:commandLink update=":friends:reviewDetail"
							oncomplete="PF('reviewDialog').show()" title="Detalji"
							styleClass="ui-icon ui-icon-search"
							style="float:left;margin-right:10px">
							<f:setPropertyActionListener value="#{review}"
								target="#{usersMB.selectedReview}" />
						</p:commandLink>
						<h:outputText value="#{review.created}">
							<f:convertDateTime pattern="HH:MM dd.MM.yyyy" />
						</h:outputText>
						<h:outputText value="&#160;-&#160;#{review.movie.name}"
							style="display:inline-block" />
					</p:dataList>
				</p:panelGrid>


				<p:dialog header="Ocjena" widgetVar="rateDialog"
					showEffect="blind" hideEffect="explode" resizable="false" modal="true" appendTo="@(body)">
					<p:outputPanel id="rateDetail" style="text-align:center;">
						<p:panelGrid columns="2"
							rendered="#{not empty usersMB.selectedRate}"
							columnClasses="label,value">
							<f:facet name="header">
								<!-- 								<p:graphicImage -->
								<!-- 									name="demo/images/car/#{dataListView.selectedCar.brand}-big.gif" /> -->
							</f:facet>

							<h:outputText value="Naziv:" />
							<h:outputText value="#{usersMB.selectedRate.movie.name}" />

							<h:outputText value="Redatelj:" />
							<h:outputText
								value="#{usersMB.selectedRate.movie.director_name}" />

							<h:outputText value="Godina:" />
							<h:outputText
								value="#{usersMB.selectedRate.movie.year_of_creation}" />

							<h:outputText value="Trajanje:" />
							<h:outputText value="#{usersMB.selectedRate.movie.duration}" />

							<h:outputText value="Informacije:" />
							<h:outputText value="#{usersMB.selectedRate.movie.info}" />

							<h:outputText value="Ukupna ocjena" />
							<h:outputText value="#{usersMB.averageRate}/10" />
						</p:panelGrid>
					</p:outputPanel>
				</p:dialog>

				<p:dialog header="Favoriti" widgetVar="favoriteDialog"
					showEffect="blind" hideEffect="explode" resizable="false" modal="true" appendTo="@(body)">
					<p:outputPanel id="favoriteDetail" style="text-align:center;">
						<p:panelGrid columns="2"
							rendered="#{not empty usersMB.selectedFavorite}"
							columnClasses="label,value">
							<f:facet name="header">
								<!-- 								<p:graphicImage -->
								<!-- 									name="demo/images/car/#{dataListView.selectedCar.brand}-big.gif" /> -->
							</f:facet>

							<h:outputText value="Naziv:" />
							<h:outputText value="#{usersMB.selectedFavorite.movie.name}" />

							<h:outputText value="Redatelj:" />
							<h:outputText
								value="#{usersMB.selectedFavorite.movie.director_name}" />

							<h:outputText value="Godina:" />
							<h:outputText
								value="#{usersMB.selectedFavorite.movie.year_of_creation}" />

							<h:outputText value="Trajanje:" />
							<h:outputText
								value="#{usersMB.selectedFavorite.movie.duration}" />

							<h:outputText value="Informacije:" />
							<h:outputText value="#{usersMB.selectedFavorite.movie.info}" />
						</p:panelGrid>
					</p:outputPanel>
				</p:dialog>

				<p:dialog header="Recenzije" widgetVar="reviewDialog"
					showEffect="blind" hideEffect="explode" resizable="false" modal="true" appendTo="@(body)">
					<p:outputPanel id="reviewDetail" style="text-align:center;">
						<p:panelGrid columns="2"
							rendered="#{not empty usersMB.selectedReview}"
							columnClasses="label,value">
							<f:facet name="header">
								<!-- 								<p:graphicImage -->
								<!-- 									name="demo/images/car/#{dataListView.selectedCar.brand}-big.gif" /> -->
							</f:facet>

							<h:outputText value="Naziv:" />
							<h:outputText value="#{usersMB.selectedReview.movie.name}" />

							<h:outputText value="Redatelj:" />
							<h:outputText
								value="#{usersMB.selectedReview.movie.director_name}" />

							<h:outputText value="Godina:" />
							<h:outputText
								value="#{usersMB.selectedReview.movie.year_of_creation}" />

							<h:outputText value="Trajanje:" />
							<h:outputText value="#{usersMB.selectedReview.movie.duration}" />

							<h:outputText value="Informacije:" />
							<h:outputText value="#{usersMB.selectedReview.movie.info}" />

							<h:outputText value="Recenzija:" />
							<h:outputText value="#{usersMB.selectedReview.review}" />
						</p:panelGrid>
					</p:outputPanel>
					
				</p:dialog>

			</h:form>

		</ui:define>
		
	</ui:composition>

</h:body>
</html>